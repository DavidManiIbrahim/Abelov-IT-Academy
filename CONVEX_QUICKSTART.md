# Quick Start with Convex

## Prerequisites
- Node.js 18+ and npm
- A Convex account (free tier available at https://convex.dev)

## Setup Instructions

### 1. Install Dependencies
```bash
npm install
```

### 2. Initialize Convex
```bash
npx convex dev
```

This will:
- Prompt you to log in to Convex (or create an account)
- Create a new Convex project
- Generate a `.env.local` file with your `VITE_CONVEX_URL`
- Start the Convex development server
- Generate TypeScript types in `convex/_generated/`

### 3. Start the Frontend
In a new terminal:
```bash
npm run dev
```

Or run both together:
```bash
npm run dev:all
```

### 4. Open the Application
Navigate to `http://localhost:5173`

## What's Different?

### Backend
- **Before**: Express + MongoDB server in `server/` directory
- **Now**: Convex serverless backend in `convex/` directory

### Key Benefits
1. **Real-time by default** - All data updates automatically
2. **No server management** - Convex handles hosting and scaling
3. **Type-safe** - Full TypeScript support with auto-generated types
4. **Simpler code** - No REST endpoints, just functions

### Project Structure
```
abelov-hub-records/
├── convex/                    # Convex backend
│   ├── schema.ts             # Database schema
│   ├── auth.ts               # Authentication functions
│   ├── hubRecords.ts         # CRUD operations
│   └── tsconfig.json         # TypeScript config
├── src/                      # Frontend (unchanged)
│   ├── lib/
│   │   ├── api.ts           # Old REST API (deprecated)
│   │   └── convexApi.ts     # New Convex API
│   └── ...
├── convex.json              # Convex configuration
└── .env.local               # Generated by Convex (contains VITE_CONVEX_URL)
```

## Migration from MongoDB

If you're migrating from the old Express + MongoDB backend, see [CONVEX_MIGRATION.md](./CONVEX_MIGRATION.md) for detailed instructions.

## Environment Variables

After running `npx convex dev`, your `.env.local` will contain:

```env
VITE_CONVEX_URL=https://your-project.convex.cloud
```

This is automatically used by the frontend to connect to Convex.

## Development Workflow

1. **Make changes to Convex functions** in `convex/`
2. **Convex dev server** automatically deploys changes
3. **Frontend** automatically reconnects and updates

## Convex Dashboard

Access your Convex dashboard at: https://dashboard.convex.dev

Here you can:
- View your data
- Monitor function calls
- Check logs
- Manage deployments

## Using Convex in Your Code

### Option 1: Compatibility Layer (Easiest)
```typescript
import { serviceRequestAPI } from '@/lib/convexApi';

// Use the same API as before
const records = await serviceRequestAPI.getByUserId(userId);
```

### Option 2: Convex Hooks (Recommended)
```typescript
import { useQuery, useMutation } from "convex/react";
import { api } from "../convex/_generated/api";

function MyComponent() {
  // Real-time query
  const records = useQuery(api.hubRecords.getRecordsByUser, { userId });
  
  // Mutation
  const createRecord = useMutation(api.hubRecords.createRecord);
  
  return <div>{/* Your UI */}</div>;
}
```

## Deployment

### Deploy to Convex Production

```bash
npx convex deploy
```

This deploys your backend to Convex's production environment.

### Deploy Frontend

Your frontend can be deployed to any static hosting service:
- Vercel
- Netlify
- Cloudflare Pages
- GitHub Pages

Just make sure to set the `VITE_CONVEX_URL` environment variable to your production Convex URL.

## Troubleshooting

### "Cannot find module 'convex/react'"
```bash
npm install convex
```

### "VITE_CONVEX_URL is not set"
```bash
npx convex dev
```

### TypeScript errors in convex/
These will resolve after running `npx convex dev`, which generates the necessary type files.

## Resources

- [Convex Documentation](https://docs.convex.dev/)
- [Convex Dashboard](https://dashboard.convex.dev/)
- [Convex Discord](https://convex.dev/community)

## Old Backend

The Express + MongoDB backend in `server/` is now deprecated but kept for reference. You can safely remove it once fully migrated to Convex.
